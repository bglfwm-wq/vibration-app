<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico Avanzado de Vibración</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .btn:active { transform: scale(0.97); }
        .btn-disabled { cursor: not-allowed; opacity: 0.5; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-8">
        <div class="text-center mb-4">
            <h1 class="text-2xl font-bold text-gray-800">Diagnóstico de Permisos</h1>
        </div>

        <!-- Diagnostic Box -->
        <div id="diagnostic-box" class="mb-6 p-4 rounded-lg">
            <!-- Content is generated by JavaScript -->
        </div>

        <!-- Method 1: Direct Vibration -->
        <div class="mb-6 opacity-60">
            <h2 class="text-base font-semibold text-gray-700 mb-2">Método 1: Respuesta Táctil</h2>
            <button class="btn w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg">
                Probar `navigator.vibrate()`
            </button>
        </div>

        <!-- Method 2: Notification Vibration -->
        <div>
            <h2 class="text-lg font-bold text-blue-600 mb-2">Método 2: Notificación (Recomendado)</h2>
            <button id="vibrate-notification" class="btn w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg btn-disabled" disabled>
                Vibrar con Notificación
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const notificationVibrateBtn = document.getElementById('vibrate-notification');
            const diagnosticBox = document.getElementById('diagnostic-box');

            function runDiagnostics() {
                let html = '';

                // 1. Check for Secure Context (HTTPS)
                if (!window.isSecureContext) {
                    html += `
                        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4">
                            <h3 class="font-bold">⚠️ Contexto no seguro detectado</h3>
                            <p class="text-sm">El navegador bloquea las notificaciones en páginas que no son HTTPS. Sube este archivo a GitHub Pages o Firebase para solucionarlo.</p>
                        </div>`;
                    diagnosticBox.innerHTML = html;
                    return; // Stop further checks if not secure
                }

                // 2. Check Notification API and Permission
                if (!('Notification' in window)) {
                     html += `<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4"><p>Este navegador no soporta Notificaciones.</p></div>`;
                } else {
                    const permission = Notification.permission;
                    switch(permission) {
                        case 'granted':
                            html += `
                                <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4">
                                    <h3 class="font-bold">✅ Permiso Concedido</h3>
                                    <p class="text-sm">El botón de notificación está listo para usarse.</p>
                                </div>`;
                            notificationVibrateBtn.disabled = false;
                            notificationVibrateBtn.classList.remove('btn-disabled');
                            break;
                        case 'denied':
                             html += `
                                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4">
                                    <h3 class="font-bold">❌ Permiso Denegado por el Sitio</h3>
                                    <p class="text-sm">Has bloqueado las notificaciones para este sitio. Debes ir a los ajustes de Chrome para este sitio web y restablecer el permiso manualmente.</p>
                                    <p class="text-xs mt-2 font-mono">Ruta: Ajustes > Configuración de sitios > Notificaciones</p>
                                </div>`;
                            break;
                        case 'default':
                            html += `
                                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4">
                                    <h3 class="font-bold">❓ Se requiere tu permiso</h3>
                                    <p class="text-sm">Haz clic en el botón de abajo para que el navegador te pida permiso para enviar notificaciones.</p>
                                    <button id="request-permission-btn" class="btn mt-3 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded">Solicitar Permiso</button>
                                </div>`;
                            break;
                    }
                }
                diagnosticBox.innerHTML = html;
                if (document.getElementById('request-permission-btn')) {
                    document.getElementById('request-permission-btn').addEventListener('click', requestNotificationPermission);
                }
            }

            function requestNotificationPermission() {
                Notification.requestPermission().then(runDiagnostics); // Re-run diagnostics after user decides
            }
            
            notificationVibrateBtn.addEventListener('click', () => {
                if (Notification.permission === 'granted') {
                    const options = {
                        vibrate: [200, 100, 200, 100, 200],
                        silent: true,
                        tag: 'vibration-test'
                    };
                    const notification = new Notification('Vibración Activada', options);
                    setTimeout(() => notification.close(), 500);
                }
            });

            runDiagnostics();
        });
    </script>
</body>
</html>


